if (self.CavalryLogger) { CavalryLogger.start_js(["bLIFC"]); }

__d("BrowseLinkType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({RESULT_PERMALINK:"result_permalink",MODULE_ENDPOINT:"module_endpoint",EXPAND_INLINE:"expand_inline",MODAL:"modal",SINGLE_TARGET_WITH_ENDPOINT:"single_target_with_endpoint",CARDED_MODAL:"carded_modal"})}),null);
__d("XAsyncSearchInlineExpandStoryController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/search/async/expand_story/",{story_token:{type:"String"},has_snippet:{type:"Bool",defaultValue:false},unicorn_story_id:{type:"String"},browse_location:{type:"String",defaultValue:"browse_location:browse"},expand_comments:{type:"Bool",defaultValue:false}})}),null);
__d("XAsyncSearchStoryModalViewController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/search/async/story_modal/",{browse_location:{type:"String",defaultValue:"browse_location:browse"},story_token:{type:"String",required:true},unicorn_story_id:{type:"String",required:true},link_type:{type:"String",defaultValue:"modal"},expand_comments:{type:"Bool",defaultValue:false},__asyncDialog:{type:"Int"}})}),null);
__d("DenseStoryInlineExpansion",["csx","cx","invariant","AsyncRequest","BanzaiODS","Bootloader","BrowseLinkType","CSS","DOM","Event","Parent","URI","XAsyncSearchInlineExpandStoryController","XAsyncSearchStoryModalViewController","tidyEvent"],(function a(b,c,d,e,f,g,h,i,j){"use strict";var k={addListenerForClick:function l(m,n){var o=false;c("tidyEvent")(c("Event").listen(m,"click",function(event){var p=event.target;if(o&&!this.isModal(n)||p instanceof HTMLElement&&this.isClickOnHeaderEntity(p))return;o=true;event.preventDefault();event.stopPropagation();if(this.isModal(n))this.handleModalClick(n,event);else if(n.linkType===c("BrowseLinkType").SINGLE_TARGET_WITH_ENDPOINT)this.handleModuleEndpointClick(n);else this.handleInlineExpansionClick(n,event)}.bind(this)))},handleModalClick:function l(m,event){var n=event.target,o=this.shouldExpandComments(n);c("Bootloader").loadModules(["AsyncDialog"],function(p){var q=c("XAsyncSearchStoryModalViewController").getURIBuilder().setString("story_token",m.storyToken).setString("unicorn_story_id",m.unicornStoryID).setString("browse_location",m.browseLocation).setString("link_type",m.linkType).setBool("expand_comments",o).getURI();p.send(new(c("AsyncRequest"))(q))},"DenseStoryInlineExpansion")},handleInlineExpansionClick:function l(m,event){var n=m.snippetElem,o=n!=null,p=event.target,q=this.shouldExpandComments(p);c("DOM").replace(m.storyElem,m.placeholderElem);var r=c("XAsyncSearchInlineExpandStoryController").getURIBuilder().setString("story_token",m.storyToken).setBool("has_snippet",o).setString("unicorn_story_id",m.unicornStoryID).setString("browse_location",m.browseLocation).setBool("expand_comments",q).getURI();c("BanzaiODS").bumpEntityKey("search_story_expansion","render_attempt");new(c("AsyncRequest"))().setURI(r).setHandler(function(s){c("DOM").replace(m.placeholderElem,s.payload);if(n!=null)c("CSS").addClass(n,"_1nlc")}).setErrorHandler(function(s){c("BanzaiODS").bumpEntityKey("search_story_expansion","render_failure")}).send()},handleModuleEndpointClick:function l(m){var n=m.moduleEndpointURI;n!=null||j(0);c("URI").go(n)},isModal:function l(m){return m.linkType===c("BrowseLinkType").CARDED_MODAL||m.linkType===c("BrowseLinkType").MODAL},shouldExpandComments:function l(m){if(!(m instanceof HTMLElement))return false;var n=c("Parent").bySelector(m,"._-56");return n!=null},isClickOnHeaderEntity:function l(m){var n=c("Parent").bySelector(m,"._vwp")||c("Parent").byClass(m,"profileLink");return n!=null}};f.exports=k}),null);